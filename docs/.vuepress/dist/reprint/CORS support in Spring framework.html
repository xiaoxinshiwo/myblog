<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CORS support in Spring Framework | 博客</title>
    <meta name="description" content="zhangyongxin&#39;s blog">
    <link rel="icon" href="/zhangyongxin/favicon.ico">
    
    <link rel="preload" href="/zhangyongxin/assets/css/styles.8185b515.css" as="style"><link rel="preload" href="/zhangyongxin/assets/js/app.8185b515.js" as="script"><link rel="preload" href="/zhangyongxin/assets/css/styles.8185b515.css" as="style"><link rel="preload" href="/zhangyongxin/assets/js/27.1c097585.js" as="script"><link rel="preload" href="/zhangyongxin/assets/js/10.6869048d.js" as="script"><link rel="prefetch" href="/zhangyongxin/assets/css/1.styles.69c23121.css"><link rel="prefetch" href="/zhangyongxin/assets/css/9.styles.bc6dcdc9.css"><link rel="prefetch" href="/zhangyongxin/assets/js/1.69c23121.js"><link rel="prefetch" href="/zhangyongxin/assets/js/11.fc309d08.js"><link rel="prefetch" href="/zhangyongxin/assets/js/12.c725fbff.js"><link rel="prefetch" href="/zhangyongxin/assets/js/13.4f5ee63e.js"><link rel="prefetch" href="/zhangyongxin/assets/js/14.01afeb6b.js"><link rel="prefetch" href="/zhangyongxin/assets/js/15.abbf578f.js"><link rel="prefetch" href="/zhangyongxin/assets/js/16.7c42db5a.js"><link rel="prefetch" href="/zhangyongxin/assets/js/17.777bdcea.js"><link rel="prefetch" href="/zhangyongxin/assets/js/18.21adfa4c.js"><link rel="prefetch" href="/zhangyongxin/assets/js/19.adcb893f.js"><link rel="prefetch" href="/zhangyongxin/assets/js/2.a3a997fa.js"><link rel="prefetch" href="/zhangyongxin/assets/js/20.85b25ddc.js"><link rel="prefetch" href="/zhangyongxin/assets/js/21.57d79d26.js"><link rel="prefetch" href="/zhangyongxin/assets/js/22.21ef4b4e.js"><link rel="prefetch" href="/zhangyongxin/assets/js/23.2c3fd0b9.js"><link rel="prefetch" href="/zhangyongxin/assets/js/24.ae9202ea.js"><link rel="prefetch" href="/zhangyongxin/assets/js/25.a0b7d798.js"><link rel="prefetch" href="/zhangyongxin/assets/js/26.8591bc67.js"><link rel="prefetch" href="/zhangyongxin/assets/js/28.9d4f2a91.js"><link rel="prefetch" href="/zhangyongxin/assets/js/29.ce7befb8.js"><link rel="prefetch" href="/zhangyongxin/assets/js/3.f9eac9a0.js"><link rel="prefetch" href="/zhangyongxin/assets/js/30.520d7518.js"><link rel="prefetch" href="/zhangyongxin/assets/js/4.05669b9d.js"><link rel="prefetch" href="/zhangyongxin/assets/js/5.821edc7a.js"><link rel="prefetch" href="/zhangyongxin/assets/js/6.5c73e778.js"><link rel="prefetch" href="/zhangyongxin/assets/js/7.f1e57cdc.js"><link rel="prefetch" href="/zhangyongxin/assets/js/8.5f48d196.js"><link rel="prefetch" href="/zhangyongxin/assets/js/9.bc6dcdc9.js">
    <link rel="stylesheet" href="/zhangyongxin/assets/css/1.styles.69c23121.css"><link rel="stylesheet" href="/zhangyongxin/assets/css/9.styles.bc6dcdc9.css"><link rel="stylesheet" href="/zhangyongxin/assets/css/styles.8185b515.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zhangyongxin/" class="home-link router-link-active"><img src="/zhangyongxin/img/logo.jpg" class="logo"> <span class="site-name can-hide">
        博客
      </span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zhangyongxin/about/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="https://github.com/xiaoxinshiwo" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div> <!----></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zhangyongxin/about/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="https://github.com/xiaoxinshiwo" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div> <!----></nav> <!----></div> <div class="page-container"><div><div class="page card"><div class="content-header"><!----> <span class="page-timestamp"></span></div> <div class="content"><h1 id="cors-support-in-spring-framework"><a href="#cors-support-in-spring-framework" aria-hidden="true" class="header-anchor">#</a> CORS support in Spring Framework</h1> <div><p>章永新 2018-05-21 15:08:11</p> <hr></div> <p>ENGINEERING   SÉBASTIEN DELEUZE   JUNE 08, 2015
For security reasons, browsers prohibit AJAX calls to resources residing outside the current origin. For example, as you’re checking your bank account in one tab, you could have the evil.com website in another tab. The scripts from evil.com shouldn’t be able to make AJAX requests to your bank API (withdrawing money from your account!) using your credentials.</p> <p>Cross-origin resource sharing (CORS) is a W3C specification implemented by most browsers that allows you to specify in a flexible way what kind of cross domain requests are authorized, instead of using some less secured and less powerful hacks like IFrame or JSONP.</p> <p>Spring Framework 4.2 GA provides first class support for CORS out-of-the-box, giving you an easier and more powerful way to configure it than typical filter based solutions.</p> <p>Spring MVC provides high-level configuration facilities, described bellow.</p> <p>Controller method CORS configuration
You can add to your @RequestMapping annotated handler method a @CrossOrigin annotation in order to enable CORS on it (by default @CrossOrigin allows all origins and the HTTP methods specified in the @RequestMapping annotation):</p> <div class="language- extra-class"><pre class="language-text"><code>@RestController
@RequestMapping(&quot;/account&quot;)
public class AccountController {

	@CrossOrigin
	@GetMapping(&quot;/{id}&quot;)
	public Account retrieve(@PathVariable Long id) {
		// ...
	}

	@DeleteMapping(&quot;/{id}&quot;)
	public void remove(@PathVariable Long id) {
		// ...
	}
}
</code></pre></div><p>It is also possible to enable CORS for the whole controller:</p> <div class="language- extra-class"><pre class="language-text"><code>@CrossOrigin(origins = &quot;http://domain2.com&quot;, maxAge = 3600)
@RestController
@RequestMapping(&quot;/account&quot;)
public class AccountController {

	@GetMapping(&quot;/{id}&quot;)
	public Account retrieve(@PathVariable Long id) {
		// ...
	}

	@DeleteMapping(&quot;/{id}&quot;)
	public void remove(@PathVariable Long id) {
		// ...
	}
}
</code></pre></div><p>In this example CORS support is enabled for both retrieve() and remove() handler methods, and you can also see how you can customize the CORS configuration using @CrossOrigin attributes.</p> <p>You can even use both controller and method level CORS configurations, Spring will then combine both annotation attributes to create a merged CORS configuration.</p> <div class="language- extra-class"><pre class="language-text"><code>@CrossOrigin(maxAge = 3600)
@RestController
@RequestMapping(&quot;/account&quot;)
public class AccountController {

	@CrossOrigin(origins = &quot;http://domain2.com&quot;)
	@GetMapping(&quot;/{id}&quot;)
	public Account retrieve(@PathVariable Long id) {
		// ...
	}

	@DeleteMapping(&quot;/{id}&quot;)
	public void remove(@PathVariable Long id) {
		// ...
	}
}
</code></pre></div><p>If you are using Spring Security, make sure to enable CORS at Spring Security level as well to allow it to leverage the configuration defined at Spring MVC level.</p> <div class="language- extra-class"><pre class="language-text"><code>@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

	@Override
	protected void configure(HttpSecurity http) throws Exception {
		http.cors().and()...
	}
}
</code></pre></div><p>Global CORS configuration
In addition to fine-grained, annotation-based configuration you’ll probably want to define some global CORS configuration as well. This is similar to using filters but can be declared withing Spring MVC and combined with fine-grained @CrossOrigin configuration. By default all origins and GET, HEAD and POST methods are allowed.</p> <p>JavaConfig
Enabling CORS for the whole application is as simple as:</p> <div class="language- extra-class"><pre class="language-text"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

	@Override
	public void addCorsMappings(CorsRegistry registry) {
		registry.addMapping(&quot;/**&quot;);
	}
}
</code></pre></div><p>If you are using Spring Boot, it is recommended to just declare a WebMvcConfigurer bean as following:</p> <div class="language- extra-class"><pre class="language-text"><code>@Configuration
public class MyConfiguration {

    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurerAdapter() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping(&quot;/**&quot;);
            }
        };
    }
}
</code></pre></div><p>You can easily change any properties, as well as only apply this CORS configuration to a specific path pattern:</p> <div class="language- extra-class"><pre class="language-text"><code>@Override
public void addCorsMappings(CorsRegistry registry) {
	registry.addMapping(&quot;/api/**&quot;)
		.allowedOrigins(&quot;http://domain2.com&quot;)
		.allowedMethods(&quot;PUT&quot;, &quot;DELETE&quot;)
			.allowedHeaders(&quot;header1&quot;, &quot;header2&quot;, &quot;header3&quot;)
		.exposedHeaders(&quot;header1&quot;, &quot;header2&quot;)
		.allowCredentials(false).maxAge(3600);
}
</code></pre></div><p>If you are using Spring Security, make sure to enable CORS at Spring Security level as well to allow it to leverage the configuration defined at Spring MVC level.</p> <p>XML namespace
It is also possible to configure CORS with the mvc XML namespace.</p> <p>This minimal XML configuration enable CORS on /** path pattern with the same default properties than the JavaConfig one:</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;mvc:cors&gt;
	&lt;mvc:mapping path=&quot;/**&quot; /&gt;
&lt;/mvc:cors&gt;
</code></pre></div><p>It is also possible to declare several CORS mappings with customized properties:</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;mvc:cors&gt;

	&lt;mvc:mapping path=&quot;/api/**&quot;
		allowed-origins=&quot;http://domain1.com, http://domain2.com&quot;
		allowed-methods=&quot;GET, PUT&quot;
		allowed-headers=&quot;header1, header2, header3&quot;
		exposed-headers=&quot;header1, header2&quot; allow-credentials=&quot;false&quot;
		max-age=&quot;123&quot; /&gt;

	&lt;mvc:mapping path=&quot;/resources/**&quot;
		allowed-origins=&quot;http://domain1.com&quot; /&gt;

&lt;/mvc:cors&gt;
</code></pre></div><p>If you are using Spring Security, don’t forget to enable CORS at Spring Security level as well:</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;http&gt;
	&lt;!-- Default to Spring MVC's CORS configuration --&gt;
	&lt;cors /&gt;
	...
&lt;/http&gt;
</code></pre></div><p>How does it work?</p> <blockquote><p>CORS requests (including preflight ones with an OPTIONS method) are automatically dispatched to the various HandlerMappings registered. They handle CORS preflight requests and intercept CORS simple and actual requests thanks to a CorsProcessor implementation (DefaultCorsProcessor by default) in order to add the relevant CORS response headers (like Access-Control-Allow-Origin). CorsConfiguration allows you to specify how the CORS requests should be processed: allowed origins, headers, methods, etc. It can be provided in various ways:</p></blockquote> <p>AbstractHandlerMapping#setCorsConfiguration() allows to specify a Map with several CorsConfiguration mapped on path patterns like /api/**
Subclasses can provide their own CorsConfiguration by overriding AbstractHandlerMapping#getCorsConfiguration(Object, HttpServletRequest) method
Handlers can implement CorsConfigurationSource interface (like ResourceHttpRequestHandler now does) in order to provide a CorsConfiguration for each request.
Filter based CORS support
As an alternative to other methods presented above, Spring Framework also provides a CorsFilter. In that case, instead of using @CrossOrigin or WebMvcConfigurer#addCorsMappings(CorsRegistry), you can for example declare the filter as following in your Spring Boot application:</p> <div class="language- extra-class"><pre class="language-text"><code>@Configuration
public class MyConfiguration {

	@Bean
	public FilterRegistrationBean corsFilter() {
		UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
		CorsConfiguration config = new CorsConfiguration();
		config.setAllowCredentials(true);
		config.addAllowedOrigin(&quot;http://domain1.com&quot;);
		config.addAllowedHeader(&quot;*&quot;);
		config.addAllowedMethod(&quot;*&quot;);
		source.registerCorsConfiguration(&quot;/**&quot;, config);
		FilterRegistrationBean bean = new FilterRegistrationBean(new CorsFilter(source));
		bean.setOrder(0);
		return bean;
	}
}
</code></pre></div><p>转载于 <a href="https://spring.io/blog/2015/06/08/cors-support-in-spring-framework" target="_blank" rel="noopener noreferrer">https://spring.io/blog/2015/06/08/cors-support-in-spring-framework<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <!----> <div class="content page-nav"><p class="inner"><span class="prev">
          ← <a href="/zhangyongxin/blog/whatHappenedWhenNewString/whatHappenedWhenNewString.html" class="prev">
            从 String str = new String(&quot;abc&quot;);说开去
          </a></span> <span class="next"><a href="/zhangyongxin/reprint/javaInterview/javaInterview1.html">
            Java面试通关要点 汇总集【最终版】
          </a> →
        </span></p></div></div> <!----></div> <!----></div> <div class="tool-group"><!----></div></div> <!----></div> <div class="background-mask" style="background:url(&quot;https://s1.ax1x.com/2018/11/07/i7AOmV.jpg&quot;) no-repeat fixed;"></div></div></div>
    <script src="/zhangyongxin/assets/js/27.1c097585.js" defer></script><script src="/zhangyongxin/assets/js/10.6869048d.js" defer></script><script src="/zhangyongxin/assets/js/app.8185b515.js" defer></script>
  </body>
</html>
